{% extends 'core/base.html' %}
{% block title %}Streaming {{ video.name }}{% endblock %}

{% block content %}
<h2 class="text-xl font-bold mb-4">Live Stream: {{ video.name }}</h2>
<p class="text-gray-500 text-sm">RTSP Source: {{ video.rtsp }}</p>

<canvas id="videoCanvas" width="640" height="480" class="border shadow"></canvas>

<script>
  const canvas = document.getElementById('videoCanvas');
  const ctx = canvas.getContext('2d');
  const videoId = "{{ video.id }}";
  
  // Prod
  const socket = new WebSocket("wss://" + window.location.host + "/stream/" + videoId);

  // Dev
  // const socket = new WebSocket("ws://127.0.0.1:8001/stream/{{ video.id }}");

  socket.onmessage = function(event) {
    const data = JSON.parse(event.data);
    const img = new Image();
    img.onload = function() {
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    };
    img.src = 'data:image/jpeg;base64,' + data.image;
  };
</script>
{% endblock %}
